---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import SeoPage from "@/components/SeoPage.astro";
import Post from "@/components/Post.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  const tagSet = new Set<string>();
  for (const p of posts) {
    (p.data.tags || []).forEach((t: string) => tagSet.add(t));
  }
  return Array.from(tagSet).map((tag) => ({ params: { tag } }));
}

const { tag } = Astro.params;
const allPosts = (await getCollection("blog")).filter((p) => (p.data.tags || []).includes(tag!)).sort((a, b) => b.data.publicationDate.valueOf() - a.data.publicationDate.valueOf());
---

<BaseLayout>
  <SeoPage slot="head" title={`${tag}`} description={`Posts tagged with ${tag}`} />
  <section class="py-3">
    <h1 class="mb-4 text-2xl font-bold">
      <a href="/authors" title="Authors" class="hover:underline">Tags</a>/{tag}
    </h1>
    {allPosts.length === 0 ? (
      <p class="text-neutral-600 dark:text-neutral-300">No posts for this tag yet.</p>
    ) : (
      <div class="grid list-none gap-4 p-0">
        {allPosts.map((post) => <Post post={post} />)}
      </div>
    )}
  </section>
</BaseLayout>
