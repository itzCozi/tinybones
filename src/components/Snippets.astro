---
import { getCollection } from "astro:content";
import Snippet from "@/components/Snippet.astro";
import Pagination from "@/components/Pagination.astro";

export interface Props {
  currentPage?: number;
  pageSize?: number;
  showPagination?: boolean;
  baseUrl?: string;
}

const { currentPage = 1, pageSize = 5, showPagination = true, baseUrl = "/snippets" } = Astro.props;

const allSnippets = (await getCollection("snippets"))
  .filter((s) => !s.data.draft)
  .sort((a, b) => b.data.publicationDate.valueOf() - a.data.publicationDate.valueOf());

const totalPages = Math.ceil(allSnippets.length / pageSize);
const startIndex = (currentPage - 1) * pageSize;
const endIndex = startIndex + pageSize;
const snippets = allSnippets.slice(startIndex, endIndex);
---

<section class="py-3">
  <h2 class="mb-3 text-lg font-bold">Snippets</h2>
  <ul class="grid list-none gap-4 p-0">
    {snippets.map((snippet) => <Snippet snippet={snippet} />)}
  </ul>
  {
    showPagination && (
      <Pagination
        currentPage={currentPage}
        totalPages={totalPages}
        baseUrl={baseUrl}
      />
    )
  }
</section>
