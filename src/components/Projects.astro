---
import { getCollection } from "astro:content";
import ExternalLink from "@/components/ExternalLink.astro";
import Pagination from "@/components/Pagination.astro";

export interface Props {
  currentPage?: number;
  pageSize?: number;
  showPagination?: boolean;
  baseUrl?: string;
}

const { currentPage = 1, pageSize = 5, showPagination = true, baseUrl = "/projects" } = Astro.props;

const allProjects = (await getCollection("projects")).sort((a, b) => {
  const dateA = a.data.publicationDate?.valueOf() ?? 0;
  const dateB = b.data.publicationDate?.valueOf() ?? 0;
  return dateB - dateA;
});

const totalPages = Math.ceil(allProjects.length / pageSize);
const startIndex = (currentPage - 1) * pageSize;
const endIndex = startIndex + pageSize;
const projects = allProjects.slice(startIndex, endIndex);
---

<section class="py-3">
  <h2 class="mb-3 text-lg font-bold">Projects</h2>
  <div class="grid list-none gap-4 p-0">
    {
      projects.map((project) => (
        <ExternalLink href={project.data.href}>{project.data.title}</ExternalLink>
      ))
    }
  </div>
  {
    showPagination && (
      <Pagination
        currentPage={currentPage}
        totalPages={totalPages}
        baseUrl={baseUrl}
      />
    )
  }
</section>
